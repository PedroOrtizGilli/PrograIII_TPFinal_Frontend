<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buscar Producto</title>
    <link rel="stylesheet" href="/css/styles.css">
    <script src="/js/global.js" defer></script>
    
</head>
<body>

    <header class="navbar">
        <h1>Gestor de Productos</h1>
        <nav>
            <ul>
                <li><a href="/">Inicio</a></li>
                <li><a href="/cargar.html">Cargar Producto</a></li>
                <li><a href="/buscar.html">Buscar por ID</a></li> 
                <li><a href="/modificar.html">Modificar Producto</a></li>
                <li><a href="/eliminar.html">Eliminar Producto</a></li>
            </ul>
        </nav>
    </header>

    <main class="admin-container"> 
        <div class="form-section">
            <h1>Consultar producto por id</h1>
            <hr>

            <form id="getProduct-form">
                <div class="form-group"> 
                    <label for="idProd">Id del producto</label>
                    <input type="number" name="idProd" id="idProd" required>
                </div>
                
                <input type="submit" value="Consultar producto" class="submit-button">
            </form>
        </div>

        <div id="contenedor-productos">
            <ul id="lista-productos"></ul>
        </div>
    </main>

    <script>
        let getProduct_form = document.getElementById("getProduct-form");
        let listaProductos = document.getElementById("lista-productos");
        
        //  Rutas relativas
        let url = "/products"; 
        

        getProduct_form.addEventListener("submit", async (event) => {
            event.preventDefault(); 
            listaProductos.innerHTML = ""; // Limpiamos la lista anterior

            console.log("Formulario no enviado");
            console.log(event.target); 

            let formData = new FormData(event.target);
            console.log(formData);
            
            let data = Object.fromEntries(formData.entries());
            console.log(data);
            
            let idProd = data.idProd;
            console.log(idProd);
            
            try {
                console.log(`Haciendo peticion GET a la url: ${url}/${idProd}`)
                let respuesta = await fetch(`${url}/${idProd}`);
                let datos = await respuesta.json();

                console.log(datos); 
                console.log(datos.payload); 

                // Quitamos el [0] porque nuestro backend devuelve 
                // el objeto directamente (o 'null' si no lo encuentra).
                let producto = datos.payload; 

                // Añadimos un 'if' para verificar si el producto existe
                if (producto) {
                    console.table(producto);

                    let htmlProducto = `
                        <li class="li-listados">
                            <img src="${producto.imagen}" alt="${producto.nombre}" style="width:100px; height:100px; object-fit:cover;">
                            <p>ID: ${producto.id}</p>
                            <h3>${producto.nombreProducto}</h3>
                            <p>Precio: $${producto.precio}</p>
                            <p>Descripción: ${producto.tipo}</p> 
                        </li>
                    `;
                    listaProductos.innerHTML = htmlProducto;
                
                } else {
                    // Si 'producto' es 'null' (no se encontró)
                    listaProductos.innerHTML = `<p>No se encontró ningún producto con el ID: ${idProd}</p>`;
                }
                
            } catch (error) {
                console.log(error);
                listaProductos.innerHTML = `<p>Ocurrió un error al buscar el producto.</p>`;
            }
            
        });

    </script>

</body>
</html>
